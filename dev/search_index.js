var documenterSearchIndex = {"docs":
[{"location":"","page":"Home","title":"Home","text":"CurrentModule = EarthSciData","category":"page"},{"location":"#EarthSciData:-Earth-Science-Data-Loaders-and-Interpolators","page":"Home","title":"EarthSciData: Earth Science Data Loaders and Interpolators","text":"","category":"section"},{"location":"","page":"Home","title":"Home","text":"Documentation for EarthSciData.","category":"page"},{"location":"","page":"Home","title":"Home","text":"","category":"page"},{"location":"","page":"Home","title":"Home","text":"Modules = [EarthSciData]","category":"page"},{"location":"#EarthSciData.DataArray","page":"Home","title":"EarthSciData.DataArray","text":"An array of data.\n\ndata: The data.\nunits: Physical units of the data, e.g. m s⁻¹.\ndescription: Description of the data.\ndimnames: Dimensions of the data, e.g. (lat, lon, layer).\n\n\n\n\n\n","category":"type"},{"location":"#EarthSciData.DataFrequencyInfo","page":"Home","title":"EarthSciData.DataFrequencyInfo","text":"Information about the temporal frequency of archived data.\n\nstart: Beginning of time of the time series.\nfrequency: Interval between each record.\ncenterpoints: Time representing the temporal center of each record.\n\n\n\n\n\n","category":"type"},{"location":"#EarthSciData.DataSetInterpolator","page":"Home","title":"EarthSciData.DataSetInterpolator","text":"DataSetInterpolators are used to interpolate data from a FileSet to represent a given time and location. Data is loaded (and downloaded) lazily, so the first time you use it on a for a given  dataset and time period it may take a while to load. Each time step is downloaded and loaded as it is needed  during the simulation and cached on the hard drive at the path specified by the \\$EARTHSCIDATADIR environment variable, or in a scratch directory if that environment variable has not been specified.  The interpolator will also cache data in memory representing the  data records for the times immediately before and after the current time step.\n\nvarname is the name of the variable to interpolate. default_time is the time to use when initializing the interpolator.\n\n\n\n\n\n","category":"type"},{"location":"#EarthSciData.FileSet","page":"Home","title":"EarthSciData.FileSet","text":"An interface for types describing a dataset, potentially comprised of multiple files.\n\nTo satisfy this interface, a type must implement the following methods:\n\nrelpath(fs::FileSet, t::DateTime)\nurl(fs::FileSet, t::DateTime)\nlocalpath(fs::GEOSFPFileSet, t::DateTime)\nDataFrequencyInfo(fs::GEOSFPFileSet, t::DateTime)::DataFrequencyInfo\nloadslice(fs::GEOSFPFileSet, t::DateTime, varname)::DataArray\nload_interpolator(fs::FileSet, t::DateTime, varname)\nvarnames(fs::FileSet, t::DateTime)\n\n\n\n\n\n","category":"type"},{"location":"#EarthSciData.GEOSFP","page":"Home","title":"EarthSciData.GEOSFP","text":"A data loader for GEOS-FP data as archived for use with GEOS-Chem classic.\n\nDomain options (as of 2022-01-30):\n\n4x5\n0.125x0.15625_AS\n0.125x0.15625_EU\n0.125x0.15625_NA\n0.25x0.3125\n0.25x0.3125_AF\n0.25x0.3125_AS\n0.25x0.3125_CH\n0.25x0.3125_EU\n0.25x0.3125_ME\n0.25x0.3125_NA\n0.25x0.3125_OC\n0.25x0.3125_RU\n0.25x0.3125_SA\n0.5x0.625\n0.5x0.625_AS\n0.5x0.625_CH\n0.5x0.625_EU\n0.5x0.15625_NA\n2x2.5\n4x5\nC180\nC720\nNATIVE\nc720\n\ncoord_defaults can be used to provide default values for the coordinates of the domain. For example if we want to perform a 2D simulation with a vertical dimension, we can set coord_defaults = Dict(:lev => 1).\n\nSee http://geoschemdata.wustl.edu/ExtData/ for current options.\n\n\n\n\n\n","category":"type"},{"location":"#EarthSciData.GEOSFPFileSet","page":"Home","title":"EarthSciData.GEOSFPFileSet","text":"GEOS-FP data as archived for use with GEOS-Chem classic.\n\nDomain options (as of 2022-01-30):\n\n4x5\n0.125x0.15625_AS\n0.125x0.15625_EU\n0.125x0.15625_NA\n0.25x0.3125\n0.25x0.3125_AF\n0.25x0.3125_AS\n0.25x0.3125_CH\n0.25x0.3125_EU\n0.25x0.3125_ME\n0.25x0.3125_NA\n0.25x0.3125_OC\n0.25x0.3125_RU\n0.25x0.3125_SA\n0.5x0.625\n0.5x0.625_AS\n0.5x0.625_CH\n0.5x0.625_EU\n0.5x0.15625_NA\n2x2.5\n4x5\nC180\nC720\nNATIVE\nc720\n\nPossible filetypes are:\n\n:A1\n:A3cld\n:A3dyn\n:A3mstC\n:A3mstE\n:I3\n\nSee http://geoschemdata.wustl.edu/ExtData/ for current options.\n\n\n\n\n\n","category":"type"},{"location":"#EarthSciData.ITPTransGroundLevel","page":"Home","title":"EarthSciData.ITPTransGroundLevel","text":"Create an interpolator that returns zero whenever z > 1, and otherwise first peforms a coordinate transformation before interpolating the data.\n\n\n\n\n\n","category":"type"},{"location":"#EarthSciData.ITPTransGroundLevel-Union{Tuple{T}, Tuple{T, T, T}} where T","page":"Home","title":"EarthSciData.ITPTransGroundLevel","text":"Perform the coordinate transformation and interpolation. \n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.NEI2016MonthlyEmis","page":"Home","title":"EarthSciData.NEI2016MonthlyEmis","text":"A data loader for CMAQ-formatted monthly US National Emissions Inventory data for year 2016,  available from: https://gaftp.epa.gov/Air/emismod/2016/v1/gridded/monthly_netCDF/. The emissions here are monthly averages, so there is no information about diurnal variation etc.\n\nspatial_ref should be the spatial reference system that  the simulation will be using. x, Δx, y, and Δy should be the coordinate variables and grid  spacing values for the simulation that is going to be run, corresponding to the given x and y  values of the given spatial_ref, and the lev represents the variable for the vertical grid level. Δx and Δy must be in units of meters, and x and y must be in the same units as spatial_ref.\n\nNOTE: This is an interpolator that returns the emissions value of the nearest grid cell  center for the underlying emissions grid, so it may not exactly conserve the total  emissions mass, especially if the simulation grid is coarser than the emissions grid.\n\nExample\n\nusing EarthSciData, ModelingToolkit, Unitful\n@parameters t lat lon lev\n@parameters Δz = 60 [unit=u\"m\"]\nemis = NEI2016MonthlyEmis{Float32}(\"mrggrid_withbeis_withrwc\", t, lon, lat, lev, Δz)\n\n\n\n\n\n","category":"type"},{"location":"#EarthSciData.NEI2016MonthlyEmisFileSet","page":"Home","title":"EarthSciData.NEI2016MonthlyEmisFileSet","text":"Archived CMAQ emissions data.\n\nCurrently, only data for year 2016 is available.\n\n\n\n\n\n","category":"type"},{"location":"#EarthSciData.centerpoint_index-Tuple{EarthSciData.DataFrequencyInfo, Any}","page":"Home","title":"EarthSciData.centerpoint_index","text":"Return the index of the centerpoint closest to the given time.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.create_interp_equation","page":"Home","title":"EarthSciData.create_interp_equation","text":"create_interp_equation(\n    itp,\n    filename,\n    t,\n    sample_time,\n    coords\n)\ncreate_interp_equation(\n    itp,\n    filename,\n    t,\n    sample_time,\n    coords,\n    scale\n)\n\n\nCreate an equation that interpolates the given dataset at the given time and location. filename is an identifier for the dataset, and t is the time variable.  The RHS of each equation will be multiplied by the optional scale.\n\n\n\n\n\n","category":"function"},{"location":"#EarthSciData.description-Tuple{EarthSciData.DataSetInterpolator, Dates.DateTime}","page":"Home","title":"EarthSciData.description","text":"description(itp, t)\n\n\nReturn the description of the data associated with this interpolator.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.dimnames-Tuple{EarthSciData.DataSetInterpolator, Dates.DateTime}","page":"Home","title":"EarthSciData.dimnames","text":"dimnames(itp, t)\n\n\nReturn the dimension names associated with this interpolator.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.endpoints-Tuple{EarthSciData.DataFrequencyInfo}","page":"Home","title":"EarthSciData.endpoints","text":"Return the time endpoints correcponding to each centerpoint\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.interp!-Union{Tuple{ITP}, Tuple{N}, Tuple{T}, Tuple{EarthSciData.DataSetInterpolator{T, N, ITP}, Dates.DateTime, Vararg{T, N}}} where {T, N, ITP}","page":"Home","title":"EarthSciData.interp!","text":"interp!(itp, t, locs)\n\n\nReturn the value of the given variable from the given dataset at the given time and location.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.interp!-Union{Tuple{ITP}, Tuple{N}, Tuple{T}, Tuple{EarthSciData.DataSetInterpolator{T, N, ITP}, T, Vararg{T, N}}} where {T, N, ITP}","page":"Home","title":"EarthSciData.interp!","text":"Interpolation with a unix timestamp.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.interp_unsafe-Union{Tuple{ITP}, Tuple{N}, Tuple{T}, Tuple{EarthSciData.DataSetInterpolator{T, N, ITP}, Dates.DateTime, Vararg{T, N}}} where {T, N, ITP}","page":"Home","title":"EarthSciData.interp_unsafe","text":"Interpolate without checking if the data has been correctly loaded for the given time.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.knots2range-Tuple{Any}","page":"Home","title":"EarthSciData.knots2range","text":"Convert a vector of evenly spaced grid points to a range.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.load_interpolator!-Union{Tuple{T}, Tuple{Array{T}, EarthSciData.GEOSFPFileSet, Dates.DateTime, Any}} where T<:Number","page":"Home","title":"EarthSciData.load_interpolator!","text":"load_interpolator!(cache, fs, t, varname)\n\n\nLoad the data for the given DateTime and variable name as an interpolator from Interpolations.jl.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.load_interpolator!-Union{Tuple{T}, Tuple{Array{T}, EarthSciData.NEI2016MonthlyEmisFileSet, Dates.DateTime, Any}} where T<:Number","page":"Home","title":"EarthSciData.load_interpolator!","text":"load_interpolator!(cache, fs, t, varname; spatial_ref)\n\n\nLoad the data for the given DateTime and variable name as an interpolator from Interpolations.jl. spatial_ref should be the spatial reference system that  the simulation will be using.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.loadslice!-Union{Tuple{T}, Tuple{Array{T}, EarthSciData.GEOSFPFileSet, Dates.DateTime, Any}} where T<:Number","page":"Home","title":"EarthSciData.loadslice!","text":"loadslice!(data, fs, t, varname)\n\n\nLoad the data for the given variable name at the given time.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.loadslice!-Union{Tuple{T}, Tuple{Array{T}, EarthSciData.NEI2016MonthlyEmisFileSet, Dates.DateTime, Any}} where T<:Number","page":"Home","title":"EarthSciData.loadslice!","text":"loadslice!(data, fs, t, varname)\n\n\nLoad the data for the given variable name at the given time.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.localpath-Tuple{EarthSciData.FileSet, Dates.DateTime}","page":"Home","title":"EarthSciData.localpath","text":"localpath(fs, t)\n\n\nReturn the local path for the file for the given DateTime.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.maybedownload-Tuple{EarthSciData.FileSet, Dates.DateTime}","page":"Home","title":"EarthSciData.maybedownload","text":"maybedownload(fs, t)\n\n\nCheck if the specified file exists locally. If not, download it.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.prune!-Tuple{ModelingToolkit.PDESystem, AbstractString}","page":"Home","title":"EarthSciData.prune!","text":"prune!(pde_sys, prefix)\n\n\nRemove equations from a PDESystem where a variable in the LHS contains the given prefix but none of the equations have an RHS containing that variable. This can be used to  remove data loading equations that are not used in the final model.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.relpath-Tuple{EarthSciData.GEOSFPFileSet, Dates.DateTime}","page":"Home","title":"EarthSciData.relpath","text":"relpath(fs, t)\n\n\nFile path on the server relative to the host root; also path on local disk relative to ENV[\"EARTHSCIDATADIR\"]  (or a scratch directory if that environment variable is not set).\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.relpath-Tuple{EarthSciData.NEI2016MonthlyEmisFileSet, Dates.DateTime}","page":"Home","title":"EarthSciData.relpath","text":"relpath(fs, t)\n\n\nFile path on the server relative to the host root; also path on local disk relative to ENV[\"EARTHSCIDATADIR\"].\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.to_unitful-Tuple{Any}","page":"Home","title":"EarthSciData.to_unitful","text":"Convert a string to a Unitful object.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.units-Tuple{EarthSciData.DataSetInterpolator, Dates.DateTime}","page":"Home","title":"EarthSciData.units","text":"units(itp, t)\n\n\nReturn the units of the data associated with this interpolator.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.url-Tuple{EarthSciData.FileSet, Dates.DateTime}","page":"Home","title":"EarthSciData.url","text":"url(fs, t)\n\n\nReturn the URL for the file for the given DateTime.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.varnames-Tuple{EarthSciData.GEOSFPFileSet, Dates.DateTime}","page":"Home","title":"EarthSciData.varnames","text":"varnames(fs, t)\n\n\nReturn the variable names associated with this FileSet.\n\n\n\n\n\n","category":"method"},{"location":"#EarthSciData.varnames-Tuple{EarthSciData.NEI2016MonthlyEmisFileSet, Dates.DateTime}","page":"Home","title":"EarthSciData.varnames","text":"varnames(fs, t)\n\n\nReturn the variable names associated with this FileSet.\n\n\n\n\n\n","category":"method"},{"location":"#ModelingToolkit.get_unit-Tuple{EarthSciData.DataSetInterpolator}","page":"Home","title":"ModelingToolkit.get_unit","text":"Return the units of the data. \n\n\n\n\n\n","category":"method"},{"location":"geosfp/#Using-data-from-GEOS-FP","page":"GEOS-FP","title":"Using data from GEOS-FP","text":"","category":"section"},{"location":"geosfp/","page":"GEOS-FP","title":"GEOS-FP","text":"using EarthSciData, EarthSciMLBase\nusing DomainSets, ModelingToolkit, MethodOfLines, DifferentialEquations\nusing Dates, Plots\n\n# Set up system\n@parameters t lev lon lat\ngeosfp = GEOSFP{Float64}(\"4x5\", t)\n\nstruct Example <: EarthSciMLODESystem\n    sys\n    function Example(t; name)\n        @variables c(t) = 5.0\n        D = Differential(t)\n        new(ODESystem([D(c) ~ sin(lat * π / 180.0 * 6) + sin(lon * π / 180 * 6)], t, name=name))\n    end\nend\n@named examplesys = Example(t)\n\ndomain = DomainInfo(\n    partialderivatives_lonlat2xymeters,\n    constIC(0.0, t ∈ Interval(Dates.datetime2unix(DateTime(2022, 1, 1)), Dates.datetime2unix(DateTime(2022, 1, 3)))),\n    zerogradBC(lat ∈ Interval(-85.0f0, 85.0f0)),\n    periodicBC(lon ∈ Interval(-180.0f0, 175.0f0)),\n    zerogradBC(lev ∈ Interval(1.0f0, 10.0f0)),\n)\n\ncomposed_sys = examplesys + domain + Advection() + geosfp;\npde_sys = get_mtk(composed_sys)\n\n# Solve\ndiscretization = MOLFiniteDifference([lat => 6, lon => 6, lev => 6], t, approx_order=2)\n@time pdeprob = discretize(pde_sys, discretization)\n\n#@run pdesol = solve(pdeprob, Tsit5(), saveat=3600.0)\n@profview pdesol = solve(pdeprob, Tsit5(), saveat=36000.0)\n@time pdesol = solve(pdeprob, Tsit5(), saveat=3600.0)\n\n# Plot\ndiscrete_lon = pdesol[lon]\ndiscrete_lat = pdesol[lat]\ndiscrete_lev = pdesol[lev]\ndiscrete_t = pdesol[t]\n\n@variables meanwind₊u(..) meanwind₊v(..) examplesys₊c(..)\nsol_u = pdesol[meanwind₊u(t, lat, lon, lev)]\nsol_v = pdesol[meanwind₊v(t, lat, lon, lev)]\nsol_c = pdesol[examplesys₊c(t, lat, lon, lev)]\n\nanim = @animate for k in 1:length(discrete_t)\n    p1 = heatmap(discrete_lon, discrete_lat, sol_c[k, 1:end, 1:end, 2], clim=(minimum(sol_c[:, :, :, 2]), maximum(sol_c[:, :, :, 2])),\n            xlabel=\"Longitude\", ylabel=\"Latitude\", title=\"examplesys.c: $(Dates.unix2datetime(discrete_t[k]))\")\n    p2 = heatmap(discrete_lon, discrete_lat, sol_u[k, 1:end, 1:end, 2], clim=(minimum(sol_u[:, :, :, 2]), maximum(sol_u[:, :, :, 2])), \n            title=\"U\")\n    p3 = heatmap(discrete_lon, discrete_lat, sol_v[k, 1:end, 1:end, 2], clim=(minimum(sol_v[:, :, :, 2]), maximum(sol_v[:, :, :, 2])),\n            title=\"V\")\n    plot(p1, p2, p3, size=(1200, 700))\nend\ngif(anim, \"animation.gif\", fps = 8)","category":"page"}]
}
